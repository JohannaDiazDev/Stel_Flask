{% extends 'admin/base_dash.html' %}
 
 {% block content %}
 
 <div class="container mx-auto py-8">
    <h2 class="text-2xl font-bold mb-4 text-[#1E4C40] text-center justify-center">Usuarios <i class="bi bi-people-fill"></i></h2>
    <div class="bg-white shadow rounded-lg p-4 mb-6 w-full">
        <div class="flex justify-between items-end flex-wrap gap-4">
            <button type="button" class="btn btn-success"style="background-color: #1E4C40; border-color: #1E4C40;" data-bs-toggle="modal" data-bs-target="#modal1">
                Registrar Usuario <i class="bi bi-person-plus"></i>
            </button>
            <form method="GET" action="{{ url_for('usuarios') }}" class="relative w-full max-w-md">
                <i class="bi bi-search absolute right-3 top-1/2 transform -translate-y-1/2 text-[#1E4C40] text-lg"></i>
                <input type="text" name="cedula" placeholder="Cédula" value="{{ cedula_buscar }}"
                    class="w-full pr-10 pl-4 py-2 border border-[#1E4C40] rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#1E4C40]">
            </form>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalUsuario" tabindex="-1" aria-labelledby="modalUsuarioLabel" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalUsuarioLabel">Registrar Usuario <i class="bi bi-person-plus"></i></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('crear_usuario') }}" method="post" class="form-usuario">
                        <input type="hidden" id="pkiduser" name="pkiduser">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="block text-sm font-medium text-[#1E4C40]" for="text">Nombre</label>
                                <input type="text" class="input-nombre mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg" name="nombre">
                                <p class="error-nombre text-sm text-red-600 mt-1 hidden">
                                    <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> El nombre debe tener mínimo 3 caracteres.
                                </p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="block text-sm font-medium text-[#1E4C40]" for="cedula">Cedula</label>
                                <input type="number" class="input-cedula mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg" name="cedula" >
                                <p class="error-cedula text-sm text-red-600 mt-1 hidden">
                                    <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> La cédula debe contener mínimo 4 caracteres.
                                </p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="block text-sm font-medium text-[#1E4C40]" for="celular">celular</label>
                                <input type="number" class="input-celular mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg" name="celular" >
                                <p class="error-celular text-sm text-red-600 mt-1 hidden">
                                    <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> Número de celular inválido.
                                </p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="block text-sm font-medium text-[#1E4C40]" for="correo">Correo</label>
                                <input type="email" class="input-correo mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg" name="correo" >
                                <p class="error-correo text-sm text-red-600 mt-1 hidden">
                                    <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> correo inválido.
                                </p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="block text-sm font-medium text-[#1E4C40]" for="contraseña">Contraseña</label>
                                <input type="password" class="input-contraseña mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg" name="contraseña" >
                                <p class="error-contraseña text-sm text-red-600 mt-1 hidden">
                                    <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> La contraseña es obligatoria.
                                </p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="block text-sm font-medium text-[#1E4C40]" for="rol_id">Rol </label>
                                <select name="rol_id" class="input-rol mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                    {% for rol in roles %}
                                        <option value="{{ rol.pkidrol }}">{{ rol.nombrerol }}</option>
                                    {% endfor %}
                                </select>
                                <p class="error-rol text-sm text-red-600 mt-1 hidden">
                                    <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> Seleccione un rol.
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" id="crear_usuario" class="btn btn-primary" style="background-color: #1E4C40; border-color: #1E4C40;">Registrar</button>
                                <button type="button" class="btn btn-secondary" style="background-color: #a11129;" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                        
                    </form>
                </div>
            </div>
        </div>
    </div>
     
    <table class="w-full mt-4 border">
        <thead>
            <tr class="bg-[#1E4C40] text-white justify-center items-center">
                <th class="p-2 text-center">Nombre</th>
                <th class="p-2 text-center">Cédula</th>
                <th class="p-2 text-center">Celular</th>
                <th class="p-2 text-center">Correo</th>
                <th class="p-2 text-center">Rol</th>
                <th class="p-2 text-center" colspan="2">Acciones</th>
            </tr>
        </thead>
        <tbody id="userTable">
            {% for usuario in usuarios %}
            <tr class="hover:bg-gray-100">
                
                <td class="border border-gray-300 px-4 py-2 text-center">{{ usuario.nombre }}</td>
                <td class="border border-gray-300 px-4 py-2 text-center">{{ usuario.cedula }}</td>
                <td class="border border-gray-300 px-4 py-2 text-center">{{ usuario.celular }}</td>
                <td class="border border-gray-300 px-4 py-2 text-center">{{ usuario.correo }}</td>
                <td class="border border-gray-300 px-4 py-2 text-center">{{ usuario.nombrerol }}</td>
                <td>
                    <button type="button" class="btn btn-sm btn-warning"style="background-color: #1E4C40; border-color: #1E4C40;" data-bs-toggle="modal" data-bs-target="#modal{{usuario.pkiduser}}">
                        <i class="bi bi-pencil-fill text-white"></i>
                    </button>
                </td>
                <td class="border border-gray-300 px-1 py-2 text-center">
                    <a href="{{ url_for('delete', pkiduser=usuario.pkiduser) }}">
                        <i class="bi bi-person-x text-[#a11129] text-xl"></i>
                    </a>
                </td>
            </tr>
            <!-- Modal Editar -->
            <div class="modal fade" id="modal{{usuario.pkiduser}}" tabindex="-1" aria-labelledby="modalLabell" aria-hidden="true">
                <div class="modal-dialog dialog-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="modalLabell">{{usuario.pkiduser}}</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('editar_usuario', pkiduser=usuario.pkiduser) }}" method="POST" class="form-editar-usuario" data-id="{{  usuario.pkiduser }}">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="block text-sm font-medium text-[#1E4C40]" for="text">Nombre</label>
                                        <input type="text" name="nombre" value="{{ usuario.nombre }}" id="nombre-editar{{ usuario.pkiduser }}" class="mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                        <p id="error-nombre-editar{{ usuario.pkiduser }}" class="text-sm text-red-600 mt-1 hidden">
                                            <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> El nombre debe tener mínimo 3 caracteres.
                                        </p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="block text-sm font-medium text-[#1E4C40]" for="cedula">Cedula</label>
                                        <input type="text" name="cedula" value="{{ usuario.cedula }}" id="cedula-editar{{ usuario.pkiduser }}" class="mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                        <p id="error-cedula-editar{{ usuario.pkiduser }}" class="text-sm text-red-600 mt-1 hidden">
                                            <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> La cédula debe contener mínimo 4 caracteres.
                                        </p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="block text-sm font-medium text-[#1E4C40]" for="celular">Celular</label>
                                        <input type="number" name="celular" value="{{ usuario.celular }}" id="celular-editar{{ usuario.pkiduser }}" class="mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                        <p id="error-celular-editar{{ usuario.pkiduser }}" class="text-sm text-red-600 mt-1 hidden">
                                            <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> Número de celular inválido.
                                        </p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="block text-sm font-medium text-[#1E4C40]" for="correo">Correo</label>
                                        <input type="email" name="correo" value="{{usuario.correo}}" id="correo-editar{{ usuario.pkiduser }}" class="mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                        <p id="error-correo-editar{{ usuario.pkiduser }}" class="text-sm text-red-600 mt-1 hidden">
                                            <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> correo inválido.
                                        </p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="block text-sm font-medium text-[#1E4C40]" for="contraseña">Contraseña</label>
                                        <input type="password" name="contraseña" value="{{usuario.contraseña}}" id="contraseña-editar{{ usuario.pkiduser }}" class="mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                        <p id="error-contraseña-editar{{ usuario.pkiduser }}" class="text-sm text-red-600 mt-1 hidden">
                                            <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> La contraseña es obligatoria.
                                        </p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="block text-sm font-medium text-[#1E4C40]" for="rol_id">Rol </label>
                                        <select name="rol_id" id="rol-editar{{ usuario.pkiduser }}" class="mt-1 block px-4 py-2 w-full border-[#1E4C40] rounded-md shadow-lg">
                                            {% for rol in roles %}
                                                <option value="{{ rol.pkidrol }}" 
                                                    {% if usuario and usuario.rol_id and usuario.rol_id == rol.pkidrol %}selected{% endif %}>
                                                    {{ rol.nombrerol }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                        <p id="error-rol-editar{{ usuario.pkiduser }}" class="text-sm text-red-600 mt-1 hidden">
                                            <i class="bi bi-exclamation-triangle-fill text-lg text-red-600"></i> Seleccione un rol.
                                        </p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-primary" style="background-color: #1E4C40; border-color: #1E4C40;">Guardar <i class="bi bi-floppy-fill"></i> </button>
                                        <button type="button" class="btn btn-success" style="background-color: #a11129;" data-bs-dismiss="modal">Cancelar</button>
                                    </div>
                                </div>  
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            {% endfor %}
        </tbody>
    </table>
    <div class="flex justify-center mt-6 space-x-2">
        {% if page > 1 %}
            <a href="{{ url_for('usuarios', page=page-1, cedula=cedula_buscar) }}" class="px-3 py-1 bg-gray-200 rounded"><i class="bi bi-chevron-double-left"></i></a>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
            <a href="{{ url_for('usuarios', page=p, cedula=cedula_buscar) }}" class="px-3 py-1 rounded {% if p == page %}bg-[#1E4C40] text-white{% else %}bg-gray-200{% endif %}">
                {{ p }}
            </a>
        {% endfor %}
        {% if page < total_pages %}
            <a href="{{ url_for('usuarios', page=page+1, cedula=cedula_buscar) }}" class="px-3 py-1 bg-gray-200 rounded"><i class="bi bi-chevron-double-right"></i></a>
        {% endif %}
    </div>
 </div>
 
 {% endblock %}
 {% block scripts %}
    <script src="{{url_for('static', filename='js/validar_usuarios.js') }}"></script>
{% endblock %}